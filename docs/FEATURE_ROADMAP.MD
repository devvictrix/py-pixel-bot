# Feature Roadmap & Status for Mark-I

This document tracks planned features and their status for the Mark-I visual automation tool. The project has progressed through initial versions, including a significant "AI-Accelerated v1.0.0" release, "v2.0.0" (advanced analysis/rules), and "v3.0.0" (Enhanced GUI & Usability). The current major focus is **"v4.0.0 (Gemini-Powered Visual Intelligence)"**.

**Key Supporting Documents:**

- `PROJECT_OVERVIEW.MD`
- `TECHNICAL_DESIGN.MD`
- `STATUS_LEGEND.MD`
- `DEV_CONFIG.MD`
- `adrs/` (especially `ADR-008` for v4.0.0)

---

## Granular Feature Breakdown (Historical & Planned)

| Version                                                                                 | Status      | Priority | Epic                     | Feature Name                                          | Description                                                                                                                                                                                                                        | Notes / Key Libraries                                                                                                         |
| :-------------------------------------------------------------------------------------- | :---------- | :------- | :----------------------- | :---------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------- |
| **v0.0.x (Core Foundations & Basic Visual PoCs) - Components of AI-Accelerated v1.0.0** |
| `v0.0.1`                                                                                | Done        | Critical | Core Capture PoC         | Define Region (Coordinates) & Capture Image           | Allow user to define a single rectangular region via (x,y,w,h) in config. Capture a single image of this region.                                                                                                                   | `OpenCV-Python`, `Pillow`, `json`.                                                                                            |
| `v0.0.1`                                                                                | Done        | Critical | Basic Setup              | Project Structure, Initial Docs, Logging Foundation   | Setup basic project folders, virtual env, core docs, foundational logging setup (per ADR-007) based on `APP_ENV`.                                                                                                                  | Manual setup, `python-dotenv`, `logging`.                                                                                     |
| `v0.0.2`                                                                                | Done        | Critical | Basic Analysis PoC       | Specific Pixel Color Check                            | In the captured region, check the color of a specific predefined pixel.                                                                                                                                                            | `OpenCV-Python` (NumPy).                                                                                                      |
| `v0.0.2`                                                                                | Done        | High     | Basic Control PoC        | CLI - Trigger Capture & Basic Analysis (Conceptual)   | Basic CLI command to trigger one-shot capture and pixel color check (now part of full CLI).                                                                                                                                        | `argparse`.                                                                                                                   |
| `v0.0.3`                                                                                | Done        | Critical | Basic Action PoC         | Conditional Mouse Click (Fixed Pos - Evolved)         | IF pixel color IS specific_color, THEN simulate a mouse click. (Evolved to richer actions).                                                                                                                                        | `pyautogui`.                                                                                                                  |
| `v0.0.3`                                                                                | Done        | High     | Configuration PoC        | Load Region & Pixel Check Params from File            | Load region coords, target pixel offset, and expected color from a JSON config file.                                                                                                                                               | `json` module.                                                                                                                |
| **v0.1.0 (Core Modules & Basic Interactions - Components of AI-Accelerated v1.0.0)**    |
| v0.1.0                                                                                  | Done        | Critical | Region Management        | Multiple Region Definitions (Config)                  | Allow defining multiple named regions in the config file.                                                                                                                                                                          | `json`.                                                                                                                       |
| v0.1.0                                                                                  | Done        | Critical | Enhanced Analysis        | Average Color of Region/Sub-region                    | Calculate the average color of the entire defined region or a sub-rectangle within it.                                                                                                                                             | `OpenCV-Python`, `NumPy`.                                                                                                     |
| v0.1.0                                                                                  | Done        | Critical | Enhanced Actions         | Click within Target Region                            | IF condition MET, click at specific relative coordinates _within_ the monitored region, or its center.                                                                                                                             | `pyautogui`.                                                                                                                  |
| v0.1.0                                                                                  | Done        | Critical | Core Loop                | Continuous Monitoring Loop (Fixed Interval)           | Implement a threaded loop that repeatedly captures, analyzes, and potentially acts.                                                                                                                                                | `threading`, `time`.                                                                                                          |
| v0.1.0                                                                                  | Done        | Critical | CLI Controls             | CLI - Start/Stop Monitoring, Load Profile             | Functional CLI (`argparse`) to load a profile, start/stop continuous monitoring.                                                                                                                                                   | `argparse`.                                                                                                                   |
| **v0.2.0 (Template Matching & Improved Rules - Components of AI-Accelerated v1.0.0)**   |
| v0.2.0                                                                                  | Done        | Critical | Advanced Analysis        | Basic Template (Image) Matching                       | User provides template image. Bot searches for this template. Reports if found, location, confidence. Template loading implemented.                                                                                                | `OpenCV-Python`.                                                                                                              |
| v0.2.0                                                                                  | Done        | Critical | Enhanced Actions         | Click Relative to Found Template                      | IF template IS found, click at an offset relative to the template's found location.                                                                                                                                                | `pyautogui`.                                                                                                                  |
| v0.2.0                                                                                  | Done        | High     | Rules Engine             | Simple Rules (IF visual_event THEN action)            | Formalize rule structure in config (per ADR-004 Option 1).                                                                                                                                                                         | `json` for rules.                                                                                                             |
| v0.2.0                                                                                  | Done        | Medium   | Performance              | Configurable FPS/Delay for Monitoring Loop            | Allow user to configure the speed of the continuous monitoring loop via profile settings.                                                                                                                                          | Profile parameter.                                                                                                            |
| **v0.3.0 (OCR Integration - Components of AI-Accelerated v1.0.0)**                      |
| v0.3.0                                                                                  | Done        | Critical | Advanced Analysis        | OCR - Text Extraction from Region                     | Extract text from the monitored region using Tesseract.                                                                                                                                                                            | `pytesseract`, `OpenCV-Python`.                                                                                               |
| v0.3.0                                                                                  | Done        | Critical | Rules Engine             | Text-Based Conditions                                 | Rules like: "IF text CONTAINS 'keyword' THEN action".                                                                                                                                                                              | String matching.                                                                                                              |
| v0.3.0                                                                                  | Done        | High     | Action Execution         | Basic Keyboard Input Action                           | IF condition MET, simulate typing a predefined string or pressing specific keys.                                                                                                                                                   | `pyautogui`.                                                                                                                  |
| v0.3.0                                                                                  | Done        | Medium   | Error Handling           | Basic OCR Error Handling                              | Handle Tesseract not found or OCR failures.                                                                                                                                                                                        | Try-except, logging.                                                                                                          |
| **v0.4.0 (Basic GUI for Region Definition - Components of AI-Accelerated v1.0.0)**      |
| v0.4.0                                                                                  | Done        | High     | Usability                | GUI Tool for Region Selection                         | GUI (`CustomTkinter`) to draw, name, confirm regions.                                                                                                                                                                              | `CustomTkinter`.                                                                                                              |
| v0.4.0                                                                                  | Done        | Medium   | Configuration            | GUI for Profile Management (Add Region to Profile)    | CLI command `--add-region` uses GUI to update profile via `ConfigManager`.                                                                                                                                                         | `CustomTkinter`, `ConfigManager`.                                                                                             |
| **v1.0.0 (AI-Accelerated Release) - STABILIZATION & DOCUMENTATION**                     |
| v1.0.0                                                                                  | Done        | Critical | Integration & Testing    | Consolidate & Test All AI-Accelerated v1.0.0 Features | Thoroughly test the `run` and `add-region` commands with various profiles and screen conditions. Identify and fix bugs. Log extensively.                                                                                           | All modules.                                                                                                                  |
| v1.0.0                                                                                  | Done        | High     | Documentation            | User Guide & README Finalization                      | Review and finalize the `README.md` to ensure it's accurate, clear, and complete for a v1.0.0 user. Add more example profiles.                                                                                                     | Markdown.                                                                                                                     |
| v1.0.0                                                                                  | Done        | Critical | Error Handling           | Robust Global Error Handling & Logging Review         | Final review of error messages and log clarity based on testing experiences. Ensure graceful failure modes.                                                                                                                        | Python `logging`, try-except.                                                                                                 |
| **v2.0.0 (Advanced Visual Analysis & Rules) - COMPLETED**                               |
| v2.0.0                                                                                  | Done        | High     | Rules Engine Enhancement | Compound Conditions (AND/OR Logic)                    | Evolve RulesEngine to support ADR-004 Option 2: multiple conditions per rule with AND/OR logic.                                                                                                                                    | Enhanced `rules_engine.py`, JSON profile schema update.                                                                       |
| v2.0.0                                                                                  | Done        | High     | Advanced Analysis        | OCR Confidence Thresholds in Rules                    | Allow rules to use OCR confidence scores (e.g., "IF text CONTAINS 'X' AND confidence > 0.85").                                                                                                                                     | `pytesseract` features, `rules_engine.py`.                                                                                    |
| v2.0.0                                                                                  | Done        | Medium   | Advanced Analysis        | Color Palette Analysis / Dominant Color               | Analyze region for dominant colors using K-Means. Rules can check against these.                                                                                                                                                   | `OpenCV-Python` (k-means).                                                                                                    |
| v2.0.0                                                                                  | Done        | Medium   | Rules Engine             | Variables in Rules / Actions                          | Allow defining temporary rule-scoped variables from analysis (OCR, template match) and using them in subsequent conditions/actions.                                                                                                | `rules_engine.py` (variable context, substitution).                                                                           |
| v2.0.0                                                                                  | Done        | Medium   | Performance              | Selective Analysis per Rule                           | Optimize `MainController` to only run specific general analyses (OCR, dominant color) on a region if an active rule requires it.                                                                                                   | `main_controller.py`, `rules_engine.py` interaction.                                                                          |
| **Internal (Non-functional / DX)**                                                      |
| N/A                                                                                     | Done        | High     | Developer Experience     | Flake8 & Black Configuration                          | Configure Flake8 and Black for consistent linting and formatting (line length 99). `logging_setup.py` updated.                                                                                                                     | `.flake8`, `pyproject.toml`.                                                                                                  |
| N/A                                                                                     | Done        | Critical | Core System              | Fix CLI `run` Command Issues (Path & Imports)         | Corrected project root detection in `ConfigManager` and missing `os`/`Callable`/`APP_ROOT_LOGGER_NAME` usage/imports in `MainController`, `AnalysisEngine`, `RulesEngine`, `ActionExecutor` to enable `run` command functionality. | `config_manager.py`, `main_controller.py`, `analysis_engine.py`, `rules_engine.py`, `action_executor.py`, `logging_setup.py`. |
| **v3.0.0 (Enhanced GUI & Usability) - COMPLETED**                                       |
| v3.0.0                                                                                  | Done        | High     | Usability                | Full GUI for Profile & Rule Configuration             | A comprehensive GUI (`MainAppWindow`) to visually create/edit profiles: regions, templates, rules (conditions, actions, parameters, structure conversion), settings. Includes robust input validation and refinements.             | `CustomTkinter`. Fully implemented and tested.                                                                                |
| v3.0.0                                                                                  | Done        | Low      | Usability                | GUI - Sub-condition/Rule Reordering (Simple)          | Added simple "Move Up/Down" buttons for sub-conditions and rules in the GUI editor lists.                                                                                                                                          | `CustomTkinter`. Implemented.                                                                                                   |
| v3.0.0                                                                                  | Not Started | Medium   | Usability                | Real-time Visual Feedback in GUI                      | GUI shows live view of monitored region(s), overlays detected elements (templates, text boxes) for easier debugging/setup of rules.                                                                                                | `OpenCV-Python` with GUI library. Deferred.                                                                                     |
| v3.0.0                                                                                  | Not Started | Medium   | Action Execution         | Chained Actions / Simple Macros                       | Allow defining a sequence of multiple actions to be performed if a single condition is met.                                                                                                                                        | Data structure for action sequences in profile, `action_executor.py`. Deferred.                                                 |
| v3.0.0                                                                                  | Not Started | Medium   | Usability                | Profile Importer/Exporter                             | Simple way to share bot profiles.                                                                                                                                                                                                  | `ConfigManager` enhancements. Deferred.                                                                                         |
| **v3.0.x (Post-Core GUI Stability - Internal Refactoring)**                             |
| v3.0.x                                                                                  | Done        | Medium   | DX/Maintainability       | GUI Component Refactoring                             | Refactored `MainAppWindow` and `DetailsPanel` into smaller, more specialized components (e.g., `RegionDetailView`, `RuleDetailView` with `ConditionEditorView`, `ActionEditorView`) for improved modularity. Strategy in `TECHNICAL_DESIGN.MD` Section 9.8. | `CustomTkinter`. Refactoring complete.                                                                                          |
| **v4.0.0 (Gemini-Powered Visual Intelligence) - CURRENT FOCUS**                         |
| v4.0.0 (Phase 1)                                                                        | Done        | Critical | Gemini Integration       | `GeminiAnalyzer` Module - Core API Client             | Create a module to handle communication with the Gemini API (Vision models), including API key management (from .env), request formation, response parsing, and error handling. See ADR-008.                                            | `google-generativeai` SDK. Implemented core class, methods, image prep, response parsing, error handling, logging.             |
| v4.0.0 (Phase 1)                                                                        | Done        | Critical | Gemini Integration       | New Condition Type: `gemini_vision_query`             | Integrate `GeminiAnalyzer` into `RulesEngine` by adding a new condition type (`gemini_vision_query`). Params: `prompt`, `expected_response_contains`, `capture_as`, etc. (see ADR-008).                                         | `rules_engine.py`, JSON schema. Modified `__init__` and `_evaluate_single_condition_logic`. Basic dot-notation JSONPath access. |
| v4.0.0 (Phase 1)                                                                        | Done        | High     | Usability (Gemini)       | GUI Support for `gemini_vision_query` Conditions      | Update `MainAppWindow` and `DetailsPanel` to allow users to create, edit, and configure `gemini_vision_query` conditions, including prompt input and response expectation parameters.                                                  | `CustomTkinter`, `gui_config.py`. `gui_config.py` updated. `MainAppWindow` updated for settings. `DetailsPanel` picks up new config & textbox height. |
| v4.0.0 (Phase 1)                                                                        | Done        | High     | Gemini Integration       | Testing: GUI, Engine, and Profile I/O for Gemini      | Thorough manual testing of creating, editing, saving, loading profiles with Gemini conditions. Test bot runs with Gemini rules. Verify error handling. Define mock strategy for `GeminiAnalyzer`.                                 | Manual testing by DevLead. `TECHNICAL_DESIGN.MD` updated with mock strategy. DevLead confirmed successful testing.           |
| v4.0.0 (Phase 1)                                                                        | Done        | High     | Documentation (Gemini)   | Gemini Integration User Guide & NFRs                  | Document API key setup, costs, privacy, prompt engineering best practices, and NFRs (latency, internet) related to Gemini features (see ADR-008). Needs update across Requirements, NFRs, Tech Design, README.                        | Markdown. Updated `README.md`, `FUNCTIONAL_REQUIREMENTS.MD`, `NON_FUNCTIONAL_REQUIREMENTS.MD`. Review of `TECHNICAL_DESIGN.MD`. |
| **v4.0.0 (Phase 1.5 - Bounding Box Actions)**                                           |
| v4.0.0 (Phase 1.5)                                                                      | Pending Review    | High     | Advanced Actions (Gemini)| Action on Gemini-Identified Element Bounding Box    | Allow actions (e.g., click) to target coordinates derived from bounding boxes returned by Gemini for identified elements. Requires new `target_relation` and `gemini_element_variable` param in ActionExecutor. See ADR-008 & Tech Design. | `action_executor.py`, `rules_engine.py` (variable handling for source_region), `gui_config.py`, `DetailsPanel`. Implementation of core logic and GUI config complete. Manual testing by DevLead is next. |
| **v4.0.0 (Phase 2 - Gemini-Informed Decision Making)**                                  |
| v4.0.0 (Phase 2)                                                                      | Planning    | High     | Gemini Integration       | Gemini-Informed Decision Making (Design & Prototype)  | Based on Gemini's visual analysis and a high-level goal, Mark-I (potentially with another Gemini text call) selects/parameterizes actions from a limited set or simple sequence. This starts to approach "AI creates rule on the fly". | New `GeminiDecisionModule`. Research/Design needed. This is a key step towards the user's "fantastic vision".                |
| **vFuture (Advanced Enhancements & Integrations - Post v4.0.0 Phase 2)**                |
| vFuture                                                                                 | Not Started | Medium   | Advanced Analysis        | Fuzzy Template Matching & Tolerance                   | Allow template matching with varying degrees of tolerance for slight changes in color, rotation, or scale.                                                                                                                         | Advanced `OpenCV-Python` techniques.                                                                                          |
| vFuture                                                                                 | Not Started | Medium   | Advanced Analysis        | Motion/Change Detection within Region                 | Detect if any significant visual change or motion occurs within a monitored region, not just static states.                                                                                                                        | Frame differencing, background subtraction.                                                                                   |
| vFuture                                                                                 | Not Started | Low      | Advanced Analysis        | Basic Object/Shape Detection (Simplified)             | Detect simple geometric shapes (circles, rectangles) or basic pre-trained objects.                                                                                                                                                 | `OpenCV-Python` (contour detection, basic ML models if lightweight).                                                          |
| vFuture                                                                                 | Not Started | High     | Advanced Actions         | Dynamic Action Parameters based on Analysis           | Enhance action execution to better use data extracted during analysis (e.g., type OCR'd number, click at OCR'd text location). Includes Gemini-derived data.                                                                   | Enhanced `action_executor.py`, `rules_engine.py`.                                                                             |
| vFuture                                                                                 | Not Started | Low      | Advanced Actions         | Sound Alerts / System Notifications                   | Play a sound or send a system notification when a condition is met.                                                                                                                                                                | `playsound` library, platform-specific notification libs.                                                                     |
| vFuture                                                                                 | Not Started | Medium   | Integration              | Webhook / API Call Action                             | Allow the bot to send an HTTP request to an external service when a condition is met.                                                                                                                                              | `requests` library. Potential ADR for security/config.                                                                        |
| vFuture                                                                                 | Not Started | High     | Usability                | Visual Logging & Debugging History                    | Save snapshots of monitored regions when rules trigger/fail. Provide a visual history or step-through for debugging rules.                                                                                                         | Image saving, GUI enhancements. Potential ADR.                                                                                |
| vFuture                                                                                 | Not Started | Medium   | Usability                | Region/Rule Library & Reusability                     | Allow users to save and import/export individual regions or rule definitions to be reused across different profiles.                                                                                                               | Enhanced `config_manager.py`.                                                                                                 |
| vFuture (Gemini Phase 3+)                                                               | Planning    | Medium   | Gemini Integration       | Natural Language Command Interface for Bot Control      | Allow user to type high-level commands (e.g., "attack monster then get items") for the bot to interpret and execute a sequence of Gemini-identified actions.                                                                      | Advanced NLU, Task Planning, Agent-like architecture. This directly addresses the user's "fantastic vision".                   |

---

**Summary & Next Steps:**

- **v1.0.0, v2.0.0, v3.0.0 Complete.**
- **v4.0.0 (Gemini-Powered Visual Intelligence): This is the active development target.**
    -   **Phase 1 - Core Integration: Status is `Done`**.
    -   **Phase 1.5 - "Action on Gemini-Identified Element Bounding Box":**
        -   **Status:** `Pending Review`.
        -   **Goal:** Enable actions (like clicks) to target elements identified by Gemini using their bounding boxes.
        -   **Notes:**
            -   `ActionExecutor._get_target_coords` modified to parse Gemini bounding box data from variables and calculate absolute click coordinates. It now expects captured Gemini variables to be dictionaries containing `value` (the actual data, e.g., `{"box": [], "found": true}`) and `_source_region_for_capture_`.
            -   `RulesEngine._evaluate_single_condition_logic` updated for `gemini_vision_query` to capture the full JSON object (if available and no specific JSON path extraction is used) along with `_source_region_for_capture_` into the `rule_variable_context`.
            -   `gui_config.py` updated:
                -   `CLICK_TARGET_RELATIONS` includes `center_of_gemini_element` and `top_left_of_gemini_element`.
                -   `UI_PARAM_CONFIG["actions"]["click"]` now defines `gemini_element_variable` with `condition_show` logic.
            -   `DetailsPanel._render_dynamic_parameters` updated to handle `condition_show` for dynamic field visibility.
            -   `DetailsPanel._get_parameters_from_ui` updated to respect conditional visibility for `required` field validation.
        -   **Next Steps for Phase 1.5 (Bounding Box Actions):**
            1.  **DevLead Review (Current Focus):** Review the implemented code changes for "Action on Gemini-Identified Element Bounding Box".
            2.  **(Post-Review) Testing:** DevLead to perform thorough manual integration testing of creating, configuring, and running profiles that use actions targeting Gemini-identified elements (bounding boxes). This includes testing various prompts for Gemini to return box data, different click relations, and error handling (e.g., malformed box data, element not found).
            3.  **Documentation Updates:** Update user guides (`README.md`), `TECHNICAL_DESIGN.MD` (if any deviations from plan or further clarifications needed), and potentially `FUNCTIONAL_REQUIREMENTS.MD`/`NON_FUNCTIONAL_REQUIREMENTS.MD` to fully reflect the new feature.
            4.  **Consideration for `_check_condition` return for `action_context['condition_region']`:** The current implementation for passing `condition_region` to `action_context` (using `determinant_region_for_action_context` derived from `_check_condition`) is a general approach. For actions targeting Gemini elements, the `_source_region_for_capture_` stored *with the variable itself* is more precise and is what `ActionExecutor` now uses. The general `action_context['condition_region']` can remain as is for other action types or as a fallback. This detail should be confirmed during review/testing.
            5.  **Mark Phase 1.5 as `Done`** upon successful review, testing, and documentation.

- **Next Major Focus: v4.0.0 (Phase 2 - Gemini-Informed Decision Making):**
    -   **Trigger:** Commence after Phase 1.5 is `Done`.
    -   **Goal:** Evolve Mark-I beyond explicit rule-action mapping by enabling Gemini to assist in selecting or parameterizing actions based on a broader understanding of the visual scene and higher-level user goals.
    -   **Initial Steps for Phase 2:**
        1.  **Detailed Design (ADR or `TECHNICAL_DESIGN.MD` Update):**
            *   Define the architecture for a `GeminiDecisionModule`.
            *   Specify how user goals/tasks will be input (e.g., simplified natural language prompts, selection from predefined task types).
            *   Outline the interaction flow: Mark-I provides scene context + goal -> Gemini suggests an action (or parameters for an action type) from a *predefined, limited set of capabilities*.
            *   Address safety, controllability, and how Mark-I vets/executes suggested actions.
        2.  **Prototyping:** Implement a basic version of the `GeminiDecisionModule` and test its feasibility with simple scenarios.
        3.  **GUI Enhancements:** Design UI elements for users to specify goals or invoke Gemini-informed actions.
    -   This phase directly addresses the "thinking then action" aspect with more advanced AI, aligning with the vision of a "great assistance".

- **Future Gemini Phases (Post v4.0.0 Phase 2):**
    - **Phase 3+ (Natural Language Command Interface):** Investigate allowing users to type high-level, multi-step commands in natural language for the bot to interpret and execute, achieving more autonomous behavior.